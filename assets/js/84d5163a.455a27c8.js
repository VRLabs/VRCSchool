"use strict";(self.webpackChunkvrc_school=self.webpackChunkvrc_school||[]).push([[5824],{7420:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>h});var n=t(5893),s=t(1151);const i={title:"Avatar Masks",sidebar_position:17,slug:"Avatar-Masks",last_edited:new Date("2024-04-01T13:51:00.000Z"),contributors:"[Jellejurre](https://jellejurre.dev/), [JustSleightly](https://vrc.sleightly.dev/)"},o="Avatar Masks {#facddcc66b6448c0974ce352240644ad}",r={id:"Avatars/Avatar-Masks",title:"Avatar Masks",description:"Contributors: Jellejurre, JustSleightly",source:"@site/docs/Avatars/Avatar-Masks.md",sourceDirName:"Avatars",slug:"/Avatars/Avatar-Masks",permalink:"/docs/Avatars/Avatar-Masks",draft:!1,unlisted:!1,editUrl:"https://github.com/VRLabs/VRCSchool/tree/main/docs/Avatars/Avatar-Masks.md",tags:[],version:"current",sidebarPosition:17,frontMatter:{title:"Avatar Masks",sidebar_position:17,slug:"Avatar-Masks",last_edited:"2024-04-01T13:51:00.000Z",contributors:"[Jellejurre](https://jellejurre.dev/), [JustSleightly](https://vrc.sleightly.dev/)"},sidebar:"sideBar",previous:{title:"VRC State Behaviours",permalink:"/docs/Avatars/State-Behaviours"},next:{title:"Head Chop",permalink:"/docs/Avatars/HeadChop"}},l={},h=[{value:"Unity Behaviour",id:"2eeeb19c8762426fa2ac708e3fa454d8",level:2},{value:"VRChat layer behaviour",id:"e460f072090f445d87e2675c41c7194b",level:2},{value:"Base Layers",id:"7171f4c674664f4982de9af91652ee56",level:2},{value:"Base",id:"c9208c0abd25469798efa441a2475033",level:3},{value:"Additive",id:"348211db75dc4cb9944c3ef806024702",level:3},{value:"Gesture",id:"777453b9e7b0401c95a5d1ca87effd4d",level:3},{value:"Action",id:"4596fe1fdeec487d9220e5d111afe0d6",level:3},{value:"FX",id:"006019057a4148aebf4b57f631cab525",level:3},{value:"Special Layers",id:"3e31e1371f474922aef9e902017fdbf0",level:2},{value:"T-pose",id:"6ea401545c1f478a9220ce8ca8d55548",level:3},{value:"IK Pose",id:"000be76bb9224b839372ac1cd90ce5a3",level:3},{value:"Sitting Pose",id:"b6cc3d822a1a4cd7a01e1fccfbb2ee3f",level:3}];function d(e){const a={a:"a",admonition:"admonition",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",ul:"ul",...(0,s.a)(),...e.components},{RightAlignedText:t}=a;return t||function(e,a){throw new Error("Expected "+(a?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("RightAlignedText",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a.p,{children:["Contributors: ",(0,n.jsx)(a.a,{href:"https://jellejurre.dev/",children:"Jellejurre"}),", ",(0,n.jsx)(a.a,{href:"https://vrc.sleightly.dev/",children:"JustSleightly"})]}),"\n",(0,n.jsx)(a.h1,{id:"facddcc66b6448c0974ce352240644ad",children:"Avatar Masks"}),"\n",(0,n.jsx)(a.h2,{id:"2eeeb19c8762426fa2ac708e3fa454d8",children:"Unity Behaviour"}),"\n",(0,n.jsx)(a.p,{children:"A mask blocks out humanoid muscle values, material swaps and transform values from animations played in an animator controller based on what is enabled and what is disabled in the mask.\r\nIf a layer has a mask with a certain value enabled in the mask, the animation is allowed to animate that value.\r\nIf a layer has a mask with a certain value disabled in the mask, the animation is not allowed to animate that value."}),"\n",(0,n.jsx)(a.p,{children:"To be specific:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"If a layer has a mask with a humanoid value (such as left hand) enabled, that humanoid muscle can be modified by an animation in that layer"}),"\n",(0,n.jsx)(a.li,{children:"If a layer has a mask with a humanoid value (such as left hand) disabled, that humanoid muscle can't be modified by an animation in that layer"}),"\n",(0,n.jsx)(a.li,{children:"If a layer has a mask with a transform value enabled or not specified, that transform can have its position, rotation and scale modified by an animation in that layer, as well as a material swap on the first material slot"}),"\n",(0,n.jsx)(a.li,{children:"If a layer has a mask with a transform value disabled, that transform can't have its position, rotation or scale, or a material swap on the first material slot modified by an animation in that layer"}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"If a layer has any mask whatsoever, it can't animate material swaps on any material slot beyond the first, or the root transform of the object with the animator on it."}),"\n",(0,n.jsx)(a.p,{children:"Anything else (blendshapes & any other components) is unaffected by masks."}),"\n",(0,n.jsx)(a.p,{children:"The reason we have masks is because if you animate a humanoid muscle on one layer, and then animate any humanoid muscle on a different layer that gets applied later (whether lower down in the animator or on a different playable layer), it gets overwritten (unless the other layer is an Additive layer, if so it adds on top of it).\r\nWith transforms, this only happens if the second animation uses WD off and is on a Playable Layer that gets applied later.\r\nSo for example if we didn\u2019t have masks, if you animated a humanoid muscle on your Gesture Layer for hand movement, it would overwrite your Base Layer and your avatar would be in default pose (bike pose) all the time."}),"\n",(0,n.jsx)(a.admonition,{type:"danger",children:(0,n.jsx)(a.p,{children:"This means that if you have a humanoid animation, without masking just the humanoid muscles you want to be enabled, and the rest disabled, all other humanoid muscles will be overwritten."})}),"\n",(0,n.jsx)(a.admonition,{type:"danger",children:(0,n.jsx)(a.p,{children:"This also means that if you have Transform animations on your Gesture layer, and you have an unmasked WD Off Transform animation on the FX layer, all the Gesture Layer Transform animations will be overwritten."})}),"\n",(0,n.jsx)(a.admonition,{type:"caution",children:(0,n.jsx)(a.p,{children:"The default VRChat FX Layer uses an unmasked WD off blend tree. This can cause transform animations to not play in VRChat as long as you are using the default FX Layer. If you want to animate transforms on the Gesture layer, you have to either use your own FX Layer or remove theirs and set it to be empty."})}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"e460f072090f445d87e2675c41c7194b",children:"VRChat layer behaviour"}),"\n",(0,n.jsx)(a.p,{children:"All playable layers are applied one after the other. First the Base, then Additive, then Gesture, then Action and lastly FX."}),"\n",(0,n.jsx)(a.p,{children:"On the first four layers (Base, Additive, Gesture & Action), you should only use animations which affect transforms (so either humanoid muscles or transform animations) and toggle gameobjects on/off."}),"\n",(0,n.jsx)(a.p,{children:"This isn't because of masking, but because these four layers are played only on your local avatar clone, but not on your mirror and shadow clones. VRChat copies the transforms and on/off state of every GameObject on your local avatar and applies them to your avatars mirror and shadow clone. However, VRChat does not copy anything other than transforms and the on/off state of each GameObject, meaning that if you were to animate anything other than that, such as blendshapes, material swaps or shader settings, VRChat will not copy those attributes to the mirror and shadow clones. The clones do however play their own FX Layer, which is why anything other than the transforms and on/off states of GameObjects should be animated in the FX Layer."}),"\n",(0,n.jsx)(a.p,{children:"For example: if you do a material swap on the Base Layer, it won't run on the mirror & shadow clones."}),"\n",(0,n.jsxs)(a.p,{children:["This article only goes into detail when it comes to masking and behaviour. If you want more information on what VRChat does with layers or what VRChat recommends you do with them, you can check out the ",(0,n.jsx)(a.a,{href:"https://creators.vrchat.com/avatars/playable-layers/",children:"official documentation"}),"."]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"7171f4c674664f4982de9af91652ee56",children:"Base Layers"}),"\n",(0,n.jsx)(a.h3,{id:"c9208c0abd25469798efa441a2475033",children:"Base"}),"\n",(0,n.jsx)(a.p,{children:"This layer should only animate transforms (either directly or through humanoid muscles) and/or GameObject on/off states for the reasons stated above."}),"\n",(0,n.jsx)(a.p,{children:"VRChat recommends this layer to be used for locomotion and to only animate humanoid muscles."}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h3,{id:"348211db75dc4cb9944c3ef806024702",children:"Additive"}),"\n",(0,n.jsx)(a.p,{children:"This layer should only animate transforms and/or GameObject on/off states for the reasons stated above."}),"\n",(0,n.jsx)(a.p,{children:"It is blended additively, meaning that any animations don\u2019t replace the base layer ones, but instead the values get added."}),"\n",(0,n.jsx)(a.p,{children:"VRChat recommends this layer to be used for tweaks to locomotion, like breathing effects, and to only animate humanoid muscles."}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h3,{id:"777453b9e7b0401c95a5d1ca87effd4d",children:"Gesture"}),"\n",(0,n.jsx)(a.p,{children:"This layer should only animate transforms and/or GameObject on/off states for the reasons stated above."}),"\n",(0,n.jsx)(a.p,{children:"VRChat takes the mask on the first layer, and applies it to all the layers in a way where if an animation (humanoid or transform) is disabled in either this mask or the layer mask itself, it is disabled."}),"\n",(0,n.jsx)(a.p,{children:"So if you want to animate any of the humanoid muscles, you will have to make a mask that specifically allows those muscles and put it in the top layer (This is why the default mask allows animations on both hands)."}),"\n",(0,n.jsx)(a.admonition,{type:"caution",children:(0,n.jsx)(a.p,{children:"Do note that a mask which allows humanoid muscles will override the Base and Additive animations for those humanoid muscles. It is therefore recommended to use Gesture for hand animations, and Base (or action for short bursts) for other humanoid animations."})}),"\n",(0,n.jsx)(a.admonition,{type:"caution",children:(0,n.jsx)(a.p,{children:"If you want to animate any transforms on Gesture, you will have to make a mask that specifically allows those transforms and the used Humanoid Muscles (usually the hands), and put it in the top layer. You will also need a custom mask for FX which disables all humanoid muscles and the animated transforms. This Transform animations are generally done on FX since you dont need to think about custom masks."})}),"\n",(0,n.jsx)(a.p,{children:"VRChat recommends this layer to be used for animations that animate transforms and humanoid animations that only affect certain body parts."}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h3,{id:"4596fe1fdeec487d9220e5d111afe0d6",children:"Action"}),"\n",(0,n.jsx)(a.p,{children:"This layer should only animate transforms and/or GameObject on/off states for the reasons stated above."}),"\n",(0,n.jsx)(a.p,{children:"This layer is blended to zero by default. Before you do anything in the action layer, you need to use the Playable Layer Control State Behavior to blend this layer up before transitioning to the actual action you're performing. Make sure you blend it back to zero when you're done, otherwise other animations won\u2019t play."}),"\n",(0,n.jsx)(a.p,{children:"VRChat recommends this layer to be used to overwrite any humanoid animations from the previous layers, like for example for emotes or AFK animations."}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h3,{id:"006019057a4148aebf4b57f631cab525",children:"FX"}),"\n",(0,n.jsx)(a.p,{children:"Since this layer runs on all your clones, this is where you can run any animations."}),"\n",(0,n.jsx)(a.p,{children:"If the first layer mask is empty, it will create a default mask that disables all humanoid muscles and enables all transforms, and applies it to all the layers in a way where if it is disabled in either this mask or the layer mask itself, it is disabled."}),"\n",(0,n.jsx)(a.admonition,{type:"caution",children:(0,n.jsx)(a.p,{children:"If you are using WD off and want to animate a transform on Gesture, you will need to make a top layer FX mask which disallows all humanoid muscles, and disables all trasnforms which you animate in Gesture. For this reason, it is easier to animate transforms in Gesture, even though this goes against what VRChat says, since you don\u2019t have to do any masking."})}),"\n",(0,n.jsx)(a.admonition,{type:"caution",children:(0,n.jsx)(a.p,{children:"VRC's default FX layer has a blendtree with write defaults off without proper masks. This can break transform animations on other layers. If you want to use transform animations on any layer, do not use the default VRC FX layer."})}),"\n",(0,n.jsx)(a.p,{children:"VRChat recommends this layer to be used for anything that isn\u2019t transform animations, like enabling/disabling GameObjects, components, material swaps, shader animations, particle system animating, etc."}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"3e31e1371f474922aef9e902017fdbf0",children:"Special Layers"}),"\n",(0,n.jsx)(a.h3,{id:"6ea401545c1f478a9220ce8ca8d55548",children:"T-pose"}),"\n",(0,n.jsx)(a.p,{children:"The T-Pose is used to determine various measurements of your avatar, especially for placement of your viewpoint (or view-ball).\r\nIt is played on its own, so masking doesn't really matter"}),"\n",(0,n.jsx)(a.h3,{id:"000be76bb9224b839372ac1cd90ce5a3",children:"IK Pose"}),"\n",(0,n.jsx)(a.p,{children:"IK Pose is used to determine major joint bends. In the IK pose, your joints should be bent slightly in the direction they're intended to bend.\r\nIt is played on its own, so masking doesn't really matter"}),"\n",(0,n.jsx)(a.h3,{id:"b6cc3d822a1a4cd7a01e1fccfbb2ee3f",children:"Sitting Pose"}),"\n",(0,n.jsx)(a.p,{children:'The controller used in this slot is used for both animation and posing. When you sit, the viewpoint of your avatar is used for calibration. The animation is played, allowing you to create a "sitting down" animation, as well as a "sitting" idle animation.\r\nIt is used like Action, where it should override all humanoid animations to make your character sit.'}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(t,{children:"Last Updated: 01 April 2024 13:51:00"})]})}function c(e={}){const{wrapper:a}={...(0,s.a)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},1151:(e,a,t)=>{t.d(a,{Z:()=>r,a:()=>o});var n=t(7294);const s={},i=n.createContext(s);function o(e){const a=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:a},e.children)}}}]);